<div class="container my-5">
  <div class="card shadow" style="width: 100%; max-width: 600px; margin: auto;">
    <div class="card-body p-4">
      <h3 class="card-title text-center text-primary mb-4">
        <i class="fas fa-user-edit me-2"></i>Editar Usuário
      </h3>

      <div *ngIf="isLoading" class="text-center mb-3">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Carregando...</span>
        </div>
        <p class="mt-2">Carregando dados do usuário...</p>
      </div>

      <form [formGroup]="userForm" (ngSubmit)="updateUser()">
        <div class="mb-3">
          <label for="name" class="form-label">Nome Completo</label>
          <input id="name" type="text" class="form-control" formControlName="name" 
                placeholder="Digite o nome completo" [class.is-invalid]="userForm.get('name')?.invalid && userForm.get('name')?.touched">
          <div *ngIf="userForm.get('name')?.invalid && userForm.get('name')?.touched" class="invalid-feedback">
            Nome completo é obrigatório
          </div>
        </div>

        <div class="mb-3">
          <label for="username" class="form-label">Nome de Usuário</label>
          <input id="username" type="text" class="form-control" formControlName="username" 
                placeholder="Digite o nome de usuário" [class.is-invalid]="userForm.get('username')?.invalid && userForm.get('username')?.touched">
          <div *ngIf="userForm.get('username')?.invalid && userForm.get('username')?.touched" class="invalid-feedback">
            Nome de usuário é obrigatório
          </div>
        </div>

        <div class="mb-3">
          <label for="email" class="form-label">E-mail</label>
          <input id="email" type="email" class="form-control" formControlName="email" 
                placeholder="Digite o e-mail" [class.is-invalid]="userForm.get('email')?.invalid && userForm.get('email')?.touched">
          <div *ngIf="userForm.get('email')?.invalid && userForm.get('email')?.touched" class="invalid-feedback">
            Por favor, insira um e-mail válido
          </div>
        </div>

        <div class="mb-3 position-relative">
          <label for="password" class="form-label">Nova Senha (Opcional)</label>
          <input 
            id="password" 
            [type]="passwordVisible ? 'text' : 'password'" 
            class="form-control" 
            formControlName="password" 
            placeholder="Digite uma nova senha"
            [class.is-invalid]="userForm.hasError('passwordMismatch')"
          />
          <i 
            class="bi position-absolute end-0 top-50 translate-middle-y me-3" 
            [ngClass]="passwordVisible ? 'bi-eye-slash' : 'bi-eye'"
            (click)="togglePasswordVisibility('password')"
          ></i>
          <small class="form-text text-muted">Deixe em branco para manter a senha atual</small>
        </div>

        <div class="mb-3 position-relative">
          <label for="confirmPassword" class="form-label">Confirmar Nova Senha</label>
          <input 
            id="confirmPassword" 
            [type]="confirmPasswordVisible ? 'text' : 'password'" 
            class="form-control" 
            formControlName="confirmPassword" 
            placeholder="Confirme a nova senha"
            [class.is-invalid]="userForm.hasError('passwordMismatch')"
          />
          <i 
            class="bi position-absolute end-0 top-50 translate-middle-y me-3" 
            [ngClass]="confirmPasswordVisible ? 'bi-eye-slash' : 'bi-eye'"
            (click)="togglePasswordVisibility('confirmPassword')"
          ></i>
          <div *ngIf="userForm.hasError('passwordMismatch')" class="invalid-feedback d-block">
            As senhas não coincidem
          </div>
        </div>

        <div class="mb-4">
          <label for="role" class="form-label">Permissão de Acesso</label>
          <select id="role" class="form-select" formControlName="role" [class.is-invalid]="userForm.get('role')?.invalid && userForm.get('role')?.touched">
            <option value="" disabled selected>Selecione uma permissão</option>
            <option value="admin">Permissão total ao sistema</option>
            <option value="employee">Permissões limitadas</option>
          </select>
          <div *ngIf="userForm.get('role')?.invalid && userForm.get('role')?.touched" class="invalid-feedback">
            Selecione uma permissão de acesso
          </div>
        </div>

        <div class="d-grid gap-2">
          <button type="submit" class="btn btn-success" [disabled]="userForm.invalid || isLoading">
            <i class="fas fa-save me-2"></i>
            {{ isLoading ? 'Salvando...' : 'Salvar Alterações' }}
          </button>
          <button type="button" class="btn btn-outline-secondary" (click)="onCancel()">
            <i class="fas fa-times me-2"></i>Cancelar
          </button>
        </div>

        <div *ngIf="errorMessage" class="alert alert-danger mt-3">
          <i class="fas fa-exclamation-triangle me-2"></i>{{ errorMessage }}
        </div>
      </form>
    </div>
  </div>

  <div *ngIf="isSuccessModalVisible" class="modal-overlay">
    <div class="modal-content card shadow-lg">
      <div class="modal-body text-center p-4">
        <i class="fas fa-check-circle text-success fa-3x mb-3"></i>
        <h4 class="modal-title mb-2">Sucesso!</h4>
        <p>{{ successMessage }}</p>
        <button class="btn btn-success mt-3" (click)="closeSuccessModal()">
          OK
        </button>
      </div>
    </div>
  </div>
</div>